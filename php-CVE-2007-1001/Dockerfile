FROM debian:latest
RUN apt-get update && apt-get install -y build-essential
RUN apt-get update && apt-get install -y gcc libc6-dev make gdb
RUN apt-get update && apt-get install -y curl wget git vim
RUN apt-get update && apt-get install -y bison flex
RUN apt-get update && apt-get install -y zlib1g-dev libpng-dev libjpeg-dev libxml2 libxml2-dev
WORKDIR /tmp
ARG VERSION=5.2.1
RUN wget http://museum.php.net/php5/php-$VERSION.tar.gz
RUN tar -zxf php-$VERSION.tar.gz && rm php-$VERSION.tar.gz
WORKDIR /tmp/php-$VERSION
COPY patch-libxml2.txt /tmp/php-$VERSION
RUN patch --ignore-whitespace --verbose -p0 < patch-libxml2.txt
RUN ./configure --with-libdir=lib/x86_64-linux-gnu --with-gd --enable-debug && make -j32 && make install
COPY poc.php poc.c /tmp/
WORKDIR /tmp
RUN gcc poc.c -o poc && ./poc
CMD php poc.php
